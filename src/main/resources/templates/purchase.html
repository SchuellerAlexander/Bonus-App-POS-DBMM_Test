<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout('Purchase', ~{::section})}">
<section class="space-y-8">
    <div class="card p-6 reveal">
        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
            <div>
                <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Purchase</div>
                <div class="font-display text-2xl">Record a Purchase</div>
            </div>
            <div class="text-sm text-ink/60">API: POST /api/purchases</div>
        </div>

        <div class="mt-6 grid gap-4 md:grid-cols-2">
            <div class="flex flex-col gap-2">
                <div class="text-xs uppercase tracking-[0.2em] text-ink/60">Account Id</div>
                <div class="font-semibold text-lg" th:text="${accountId}">-</div>
            </div>
        </div>

        <form class="mt-6 grid gap-4 md:grid-cols-2" action="/purchase" method="post" data-loading>
            <div class="flex flex-col gap-2">
                <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="restaurantId">Restaurant</label>
                <select class="input" id="restaurantId" name="restaurantId" required>
                    <option value="" th:selected="${selectedRestaurantId == null}" disabled>Select a restaurant</option>
                    <option th:each="restaurant : ${restaurants}"
                            th:value="${restaurant.id}"
                            th:selected="${restaurant.id == selectedRestaurantId}"
                            th:text="${restaurant.name}">Restaurant</option>
                </select>
            </div>
            <div class="flex flex-col gap-2 md:col-span-2">
                <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="purchaseNumber">Purchase Number</label>
                <input class="input" id="purchaseNumber" name="purchaseNumber" placeholder="PUR-12345" required>
            </div>
            <div class="flex flex-col gap-2">
                <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="totalAmount">Total Amount</label>
                <input class="input" id="totalAmount" name="totalAmount" type="number" min="0.01" step="0.01" placeholder="12.50" required>
            </div>
            <div class="flex flex-col gap-2">
                <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="currency">Currency</label>
                <input class="input" id="currency" name="currency" type="text" maxlength="3" th:value="${currency}">
            </div>
            <div class="flex flex-col gap-2 md:col-span-2">
                <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="notes">Notes</label>
                <input class="input" id="notes" name="notes" type="text" placeholder="Optional note">
            </div>
            <div class="flex flex-col gap-2 md:col-span-2">
                <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="description">Description</label>
                <input class="input" id="description" name="description" type="text" placeholder="Optional description">
            </div>
            <div class="md:col-span-2 flex items-center gap-3">
                <button class="btn-primary" type="submit">Submit Purchase</button>
                <span class="text-xs text-ink/60">We will calculate points via the backend rule.</span>
            </div>
        </form>
    </div>

    <div th:if="${apiError != null}" class="card p-4 border border-red-200 bg-red-50 text-red-900 reveal">
        <div class="font-semibold" th:text="${apiError.error}">Error</div>
        <div class="text-sm" th:text="${apiError.message}">Message</div>
    </div>

    <div th:if="${purchaseResponse != null}" class="card p-6 bg-emerald-50 border border-emerald-200 reveal">
        <div class="text-sm uppercase tracking-[0.2em] text-emerald-700">Success</div>
        <div class="font-display text-2xl text-emerald-900">Purchase Recorded</div>
        <div class="mt-4 grid gap-2 text-sm">
            <div class="flex justify-between border-b border-emerald-200/70 py-2">
                <span>Purchase Id</span>
                <span th:text="${purchaseResponse.purchaseId}">-</span>
            </div>
            <div class="flex justify-between border-b border-emerald-200/70 py-2">
                <span>Points Earned</span>
                <span th:text="${purchaseResponse.points}">0</span>
            </div>
            <div class="flex justify-between border-b border-emerald-200/70 py-2">
                <span>Balance After</span>
                <span th:text="${purchaseResponse.balanceAfter}">0</span>
            </div>
        </div>
        <a class="btn-secondary mt-4 inline-block" href="/dashboard">Back to Dashboard</a>
    </div>
</section>
</html>
