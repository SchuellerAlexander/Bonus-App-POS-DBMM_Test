<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout('Rewards', ~{::section})}">
<section class="space-y-8">
    <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
        <div class="card p-6 reveal">
            <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Schritt 1 · Übersicht</div>
            <div class="font-display text-2xl">Punkte einlösen</div>
            <p class="mt-2 text-sm text-ink/60">
                Du kannst deine Punkte bei teilnehmenden Restaurants einlösen.
            </p>
        </div>
        <div class="card p-6 reveal">
            <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Aktueller Punktestand</div>
            <div class="points-big" th:text="${account != null ? account.currentPoints : 0}">0</div>
            <div class="mt-4 text-sm text-ink/60">Account Id: <span class="font-semibold" th:text="${accountId}">-</span></div>
        </div>
    </div>

    <div th:if="${apiError != null}" class="card p-4 border border-red-200 bg-red-50 text-red-900 reveal">
        <div class="font-semibold" th:text="${apiError.error}">Error</div>
        <div class="text-sm" th:text="${apiError.message}">Message</div>
    </div>

    <div class="card p-6 reveal">
        <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Schritt 2 · Restaurant auswählen</div>
        <div class="font-display text-xl">Wähle ein Restaurant</div>
        <form class="mt-4 grid gap-4 md:grid-cols-[2fr,auto]" action="/rewards" method="get" data-loading>
            <div class="flex flex-col gap-2">
                <label class="text-xs uppercase tracking-[0.2em] text-ink/60" for="restaurantId">Restaurant</label>
                <select class="input" id="restaurantId" name="restaurantId" required>
                    <option th:each="restaurant : ${restaurants}"
                            th:value="${restaurant.id}"
                            th:selected="${restaurant.id == restaurantId}"
                            th:text="${restaurant.name}">
                        Restaurant
                    </option>
                </select>
            </div>
            <div class="flex items-end">
                <button class="btn-secondary w-full" type="submit">Auswählen</button>
            </div>
        </form>
    </div>

    <div class="space-y-4">
        <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Schritt 3 · Verfügbare Rewards</div>
        <div class="grid gap-6 md:grid-cols-2">
            <div class="card p-6 reveal"
                 th:each="reward : ${rewards}"
                 th:classappend="${account == null or account.currentPoints < reward.costPoints} ? 'opacity-60' : ''">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Reward</div>
                        <div class="font-display text-xl" th:text="${reward.name}">Reward</div>
                    </div>
                    <div class="stat-pill" th:text="${reward.costPoints + ' pts'}">0 pts</div>
                </div>
                <p class="mt-2 text-sm text-ink/60" th:text="${reward.description}">Description</p>

                <form class="mt-6 space-y-3" action="/rewards/redeem" method="post" data-loading>
                    <input type="hidden" name="rewardId" th:value="${reward.id}">
                    <input type="hidden" name="branchId" th:value="${defaultBranchId}">
                    <input type="hidden" name="restaurantId" th:value="${restaurantId}">
                    <div class="flex flex-col gap-2">
                        <label class="text-xs uppercase tracking-[0.2em] text-ink/60" th:for="'notes-' + ${reward.id}">Notes</label>
                        <input class="input" name="notes" type="text" placeholder="Optional note"
                               th:id="'notes-' + ${reward.id}">
                    </div>
                    <button class="btn-primary w-full"
                            type="submit"
                            th:disabled="${defaultBranchId == null or account == null or account.currentPoints < reward.costPoints}">
                        Einlösen
                    </button>
                </form>
            </div>
        </div>
        <div class="card p-6 text-sm text-ink/60" th:if="${rewards == null or #lists.isEmpty(rewards)}">
            Für dieses Restaurant sind aktuell keine Rewards verfügbar.
        </div>
    </div>
</section>
</html>
