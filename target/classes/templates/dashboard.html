<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout('Dashboard', ~{::section})}">
<section class="space-y-8">
    <div class="grid gap-6 lg:grid-cols-[2fr,1fr]">
        <div class="card p-6 reveal">
            <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                <div>
                    <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Account</div>
                    <div class="font-display text-2xl">Dashboard Overview</div>
                </div>
                <div class="flex items-center gap-6">
                    <div>
                        <div class="text-xs uppercase tracking-[0.2em] text-ink/60">Account Id</div>
                        <div class="font-semibold text-lg mt-1" th:text="${accountId}">-</div>
                    </div>
                    <input type="hidden" id="accountId" th:value="${accountId}">
                </div>
            </div>
        </div>

        <div class="card p-6 flex flex-col gap-4 justify-between reveal">
            <div>
                <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Current Points</div>
                <div class="points-big" th:text="${account != null ? account.currentPoints : 0}">0</div>
            </div>
            <div class="flex flex-wrap gap-2">
                <span class="stat-pill" th:text="${account != null ? account.status : 'N/A'}">N/A</span>
                <span class="stat-pill" th:text="${account != null ? account.tier : 'N/A'}">N/A</span>
            </div>
        </div>
    </div>

    <div th:if="${apiError != null}" class="card p-4 border border-red-200 bg-red-50 text-red-900 reveal">
        <div class="font-semibold" th:text="${apiError.error}">Error</div>
        <div class="text-sm" th:text="${apiError.message}">Message</div>
    </div>

    <div class="grid gap-6 lg:grid-cols-[1fr]">
        <div class="card p-6 reveal">
            <div class="text-sm uppercase tracking-[0.2em] text-ink/60">Latest Ledger Entries</div>
            <div class="mt-4 space-y-3" th:if="${account != null and account.ledgerEntries != null}">
                <button type="button"
                        class="ledger-row ledger-row-button w-full text-left"
                        th:each="entry, iter : ${account.ledgerEntries}"
                        th:if="${iter.index < 6}"
                        th:attr="data-ledger-id=${entry.id}">
                    <div class="flex items-center justify-between">
                        <div class="font-semibold" th:text="${entry.entryType}">EARN</div>
                        <div class="text-sm text-ink/60" th:text="${entry.occurredAt}">-</div>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span th:text="${entry.description}">Description</span>
                        <span th:text="${entry.points}">0</span>
                    </div>
                    <div class="text-xs text-ink/60">Balance after: <span th:text="${entry.balanceAfter}">0</span></div>
                </button>
            </div>
            <div class="mt-4 text-sm text-ink/60" th:if="${account == null or account.ledgerEntries == null}">
                No ledger entries loaded.
            </div>
        </div>
    </div>

    <div id="ledgerModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content card">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-display text-2xl">Purchase Details</h2>
                <button id="closeLedgerModalBtn" class="text-ink/60 hover:text-ink text-2xl" aria-label="Close">&times;</button>
            </div>
            <div id="ledgerContent" class="space-y-4">
                <!-- Content loaded via JavaScript -->
            </div>
        </div>
    </div>
</section>
</html>
